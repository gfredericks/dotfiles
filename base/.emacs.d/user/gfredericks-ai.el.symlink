(provide 'gfredericks-ai)

(require 'gfredericks-longrunning)
(require 'gfredericks-packages)

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;; gptel

;; Thanks Bruce Hauman!

(gfredericks-packages-install 'gptel)

(require 'gptel)

(setq gptel-api-key (getenv "OPENAI_API_KEY"))

(gptel-make-anthropic "Claude"          ;Any name you want
  :stream t                             ;Streaming responses
  :key (getenv "ANTHROPIC_API_KEY"))

;; (gptel-make-gemini "Gemini"
;;   :key (getenv "GEMINI_API_KEY")
;;   :stream t)
(setq gptel-model 'gpt-5)


(defun is-codex-running? (buffer-name)
  (interactive)
  "Returns true if the buffer given by buffer-name has the texts
   \"Working\" and \"Esc to interrupt\" on its last line."
  (with-current-buffer buffer-name
    (save-excursion
      (goto-char (point-max))
      (let ((last-line (thing-at-point 'line t)))
        (and (string-match "Working" last-line) t)))))

(defun is-bash-running? (buffer-name)
  (interactive)
  "Returns true if the buffer given by buffer-name has the text
   \"$ \" on its last line"
  (with-current-buffer buffer-name
    (save-excursion
      (goto-char (point-max))
      (let ((last-line (thing-at-point 'line t)))
        (not (string-match-p "^\\$[ \t\r\n]*$" last-line))))))
